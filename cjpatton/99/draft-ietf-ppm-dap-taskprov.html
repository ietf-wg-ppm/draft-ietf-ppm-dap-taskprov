<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>Task Binding and In-Band Provisioning for DAP</title>
<meta content="Shan Wang" name="author">
<meta content="Christopher Patton" name="author">
<meta content="
       An extension for the Distributed Aggregation Protocol (DAP) is specified that
cryptographically binds the parameters of a task to the task's execution. In
particular, when a client includes this extension with its report, the servers
will only aggregate the report if all parties agree on the task parameters.
This document also specifies an optional mechanism for in-band task
provisioning that builds on the report extension. 
    " name="description">
<meta content="xml2rfc 3.30.1" name="generator">
<meta content="next generation" name="keyword">
<meta content="unicorn" name="keyword">
<meta content="sparkling distributed ledger" name="keyword">
<meta content="draft-ietf-ppm-dap-taskprov-latest" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.30.1
    Python 3.12.11
    ConfigArgParse 1.7
    google-i18n-address 3.1.1
    intervaltree 3.1.0
    Jinja2 3.1.6
    lxml 5.3.1
    platformdirs 4.4.0
    pycountry 24.6.1
    PyYAML 6.0.2
    requests 2.32.5
    setuptools 80.9.0
    wcwidth 0.2.13
-->
<link href="draft-ietf-ppm-dap-taskprov.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}

@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Lora SemiBold'), local('Lora-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C8A, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-cyrillic.woff2') format('woff2');
  unicode-range: U+0301, U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-greek.woff2') format('woff2');
  unicode-range: U+0370-0377, U+037A-037F, U+0384-038A, U+038C, U+038E-03A1, U+03A3-03FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-02BA, U+02BD-02C5, U+02C7-02CC, U+02CE-02D7, U+02DD-02FF, U+0304, U+0308, U+0329, U+1D00-1DBF, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C8A, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0301, U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-greek.woff2') format('woff2');
  unicode-range: U+0370-0377, U+037A-037F, U+0384-038A, U+038C, U+038E-03A1, U+03A3-03FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-02BA, U+02BD-02C5, U+02C7-02CC, U+02CE-02D7, U+02DD-02FF, U+0304, U+0308, U+0329, U+1D00-1DBF, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

:root {
  color-scheme: light dark;
  --background-color: #fff;
  --text-color: #222;
  --title-color: #191919;
  --link-color: #2a6496;
  --highlight-color: #f9f9f9;
  --line-color: #eee;
  --pilcrow-weak: #ddd;
  --pilcrow-strong: #bbb;
  --small-font-size: 14.5px;
  --font-mono: 'Oxygen Mono', monospace;
  --font-title: "Sofia Sans Semi Condensed", sans-serif;
  scrollbar-color: #bbb #eee;
}
body {
  max-width: 600px;
  margin: 75px auto;
  padding: 0 5px;
  color: var(--text-color);
  background-color: var(--background-color);
  font: 16px/22px "Lora", serif;
  scroll-behavior: smooth;
}

.ears {
  display: none;
}

/* headings */
section {
  clear: both;
}
.section-number {
  padding-right: 0.5em;
}
h1, h2, h3, h4, h5, h6 {
  font-family: var(--font-title);
  font-weight: 680;
  margin: 0.8em 0 0.3em;
  font-size-adjust: 0.5;
  color: var(--title-color);
}
h1#title {
  font-size: 32px;
  line-height: 40px;
  clear: both;
}
h1#title, h1#rfcnum {
  margin: 1.5em 0 0.2em;
}
h1#rfcnum + h1#title {
  margin: 0.2em 0;
}

h1, h2, h3 {
  font-size: 22px;
  line-height: 27px;
}
h4, h5, h6 {
  font-size: 20px;
  line-height: 24px;
}

/* general structure */
.author {
  padding-bottom: 0.3em;
  vertical-align: top;
}
#abstract+p {
  font-size: 18px;
  line-height: 24px;
}
#abstract+p code, #abstract+p samp, #abstract+p tt {
  font-size: 16px;
  line-height: 0;
}

p {
  padding: 0;
  margin: 0.5em 0;
  text-align: left;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignRight.art-text pre {
  padding: 0;
  width: auto;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
/* font-family isn't space-separated, but =~ will have to do */
svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
  font-family: var(--font-mono);
}
.alignCenter.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignCenter.art-text pre {
  padding: 0;
  width: auto;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 0.5em 2em;
  & :is(ol, ul) {
    margin-left: 1em;
  }
}
li {
  margin: 0 0 0.25em 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
  & li {
    margin-top: 0.5em;
  }
}
:is(ul, ol).compact, .ulCompact, .olCompact {
  margin: 0 0 0 2em;
  & li {
    margin: 0;
    & :first-child { margin-top: 0; }
    & :last-child { margin-bottom: 0; }
  }
}

/* definition lists */
dl {
  clear: left;
  --indent: 3ch;
  /* --indent: attr(indent ch); not supported in any browser, but we can dream */
  &.olPercent {
    --indent: 5ch;
    & > dt {
      min-width: calc(var(--indent) - 2ch);
    }
  }
  &.olPercent > dt {
    float: none;
  }

  dl > dd > & {
    margin-top: 0.5em;
    margin-bottom: 0;
  }
}
dl:not(.dlNewline) > dt {
  float: left;
  margin-right: 2ch;
  min-width: 8ch;
}
dl > dd {
  margin-bottom: .8em;
  margin-left: var(--indent) !important; /* stupid element overrides */
  min-height: 2ex;
}
:is(dl.compact, .dlCompact) > dd {
  margin-bottom: 0;
  & > :is(:first-child, .break:first-child + *) {
    margin-top: 0;
  }
  & > :is(:last-child) {
    margin-bottom: 0;
  }
}
:is(dd, span).break {
  display: none;
}

/* links */
a, a[href].selfRef:hover {
  text-decoration: none;
}
a[href] {
  color: var(--link-color);
}
a[href].selfRef, .iref + a[href].internal {
  color: var(--text-color);
}
a[href]:hover {
  text-decoration: underline;
}
a[href].selfRef:hover {
  background-color: var(--highlight-color);
}
a.xref:is(.cite, .auto), :is(#status-of-memo, #copyright) a {
  white-space: nowrap;
}

/* Figures */
tt, code, pre {
  background-color: var(--highlight-color);
  font: 14px/22px var(--font-mono);
}
tt, code {
  /* changing the font for inline elements leads to different ascender
     and descender heights; as we want to retain baseline alignment,
     remove leading to avoid altering the final height of lines
     note: this fails if these blocks take an entire line,
     a different solution would be great */
  line-height: 0;
}
:is(h1, h2, h3, h4, h5, h6) :is(tt, code) {
  font-size: 84%;
}
pre {
  border: 1px solid var(--line-color);
  font-size: 13.5px;
  line-height: 16px;
  letter-spacing: -0.2px;
  margin: 5px;
  padding: 5px;
}
img {
  max-width: 100%;
}
figure {
  margin: 0.5em 0;
  padding: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption, caption {
  font-style: italic;
  margin: 0.5em 1.5em;
  text-align: left;
  caption-side: bottom;
}
@media screen {
  /* Auto-collapse boilerplate. */
  :is(#status-of-memo, #copyright) p {
    margin: -2px 0;
    max-height: 0;
    transition: max-height 2s ease, margin 0.5s ease 0.5s;
    overflow: hidden;
  }
  :is(#status-of-memo, #copyright):hover p,
  :is(#status-of-memo, #copyright) h2:target ~ p {
    margin: 0.5em 0;
    max-height: 500px;
    overflow: auto;
  }
  pre, svg {
    display: inline-block;
    /* In the horizontal direction, sometimes people make over-sized figures.
       Scrollbars for those is therefore necessary: auto adds them as necessary..
       In the vertical direction, the line-height can combine with the font
       asender/descender height to produce scrollbars: hidden avoids that. */
    overflow: auto hidden;
  }
  pre {
    max-width: 100%;
    width: calc(100% - 22px - 1em);
  }
  svg {
    max-width: calc(100% - 22px - 1em);
  }
  figure pre {
    display: block;
    width: calc(100% - 25px);
  }
  :is(pre, svg) + .pilcrow {
    display: inline-block;
    vertical-align: text-bottom;
    padding-bottom: 8px;
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 0 2em;
  font-style: italic;
}
blockquote {
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: auto;
  max-width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
}
table.right {
  margin-left: auto;
}
table.center {
  margin-left: auto;
  margin-right: auto;
}
table.left {
  margin-right: auto;
}
table .text-left {
  text-align: left;
}
table .text-center {
  text-align: center;
}
table .text-right {
  text-align: right;
}

thead, tbody {
  border: 1px solid var(--line-color);
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 5px 10px;
}
th {
  background-color: var(--line-color);
}
:is(tr:nth-child(2n), thead+tbody > tr:nth-child(2n+1)) > td {
  background-color: var(--background-color);
}
:is(tr:nth-child(2n+1), thead+tbody > tr:nth-child(2n)) > td {
  background-color: var(--highlight-color);
}
table caption {
  margin: 0;
  padding: 3px 0 3px 1em;
}
table p {
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  margin-left: 3px;
  opacity: 0.2;
  user-select: none;
  &[href] {
    color: var(--pilcrow-weak);
    &:hover { text-decoration: none; }
  }
}
@media not print {
  :hover > a.pilcrow {
    opacity: 1;
  }
  a.pilcrow[href]:hover {
    color: var(--pilcrow-strong);
    background-color: transparent;
  }
}
@media print {
  a.pilcrow {
    display: none;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid var(--line-color);
}
.bcp14 {
  font-variant: small-caps;
  font-weight: 600;
  font-size: var(--small-font-size);
}
.role {
  font-variant: all-small-caps;
}
sub, sup {
  line-height: 1;
  font-size: 80%;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: var(--small-font-size);
  line-height: 18px;
  --identifier-width: 15ch;
  & dt {
    width: var(--identifier-width);
    min-width: var(--identifier-width);
    clear: left;
    float: left;
    text-align: right;
    margin-right: 1ch;
  }
  & dd {
    margin: 0;
    margin-left: calc(1em + var(--identifier-width)) !important;
    min-width: 5em;
  }
  & .authors {
    & .author {
      display: inline-block;
      margin-right: 1.5em;
    }
    & .org {
      font-style: italic;
    }
  }
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #999;
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;

  & nav {
    & ul {
      margin: 0 0.5em 0 0;
      padding: 0;
      list-style: none;
    }
    & li {
      line-height: 1.3em;
      margin: 2px 0;
      padding-left: 1.2em;
      text-indent: -1.2em;
    }
  }
  & a.xref {
    white-space: normal;
  }
}

.references {
  & > dt {
    text-align: right;
    font-weight: bold;
    min-width: 10ch;
    margin-right: 1.5ch;
    &:target::before {
      content: "⇒";
      margin: 0 10px 0 -25px;
    }
  }
  & > dd {
    margin-left: 12ch !important;
    overflow: visible;
    & .refInstance {
      margin-bottom: 0.8em;
    }
    & .ascii {
      margin-bottom: 0.25em;
    }
  }
}

#rfc\.index\.index + ul {
  margin-left: 0;
}

/* authors */
address.vcard {
  font-style: normal;
  max-width: 20em;
  margin: 1em auto 1em 0;

  & .nameRole {
    font-weight: 700;
    margin-left: 0;
  }
  & .label {
    margin: 0.5em 0;
  }
  & .type {
    display: none;
  }
  & .alternative-contact {
    margin: 0.5em 0 0.25em 0;
  }
  & .non-ascii {
    margin: 0 0 0 2em;
  }
  & div.left {
    text-align: left;
  }
  & div.right {
    text-align: right;
  }
}

hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}
@media (min-width: 500px) {
  #authors-addresses > section {
    column-count: 2;
    column-gap: 20px;
  }
  #authors-addresses > section > h2 {
    column-span: all;
  }
  /* hack for break-inside: avoid-column */
  #authors-addresses address {
    display: inline-block;
    break-inside: avoid-column;
  }
}

/* Comments */
.rfcEditorRemove p:first-of-type {
  font-style: italic;
}
.cref {
  background-color: rgba(249, 232, 105, 0.3);
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}

@media screen {
  #toc nav {
    font-family: var(--font-title);
    font-weight: 360;
    & > ul { margin-bottom: 2em; }
    & ul {
      margin: 0 0 0 4px;
      & :is(p, li) {
        margin: 2px 0;
      }
    }
  }
  #toc a.toplink {
    float: right;
  }
}
@media not screen {
  #toc a.toplink {
    display: none;
  }
}


/* TOC layout for smaller screens */
@media screen and (max-width: 929px) {
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 1px 0 0 0;
    margin: 0;
    border-bottom: 1px solid #ccc;
    opacity: 0.6;
  }
  #toc h2 {
    margin: 0;
    padding: 2px 0 2px 6px;
    padding-right: 1em;
    font-size: 18px;
    line-height: 24px;
    min-width: 190px;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
    &::before { /* css hamburger */
      float: right;
      position: relative;
      width: 1em;
      height: 1px;
      left: -164px;
      margin: 8px 0 0 0;
      background: white none repeat scroll 0 0;
      box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
      content: "";
    }
  }
  #toc nav {
    display: none;
    background-color: var(--background-color);
    padding: 0.5em 1em 1em;
    overflow: auto;
    overscroll-behavior: contain;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
  #toc.active {
    opacity: 1;
    & nav { display: block; }
  }
  /* Make the collapsed ToC header render white on gray also when it's a link */
  #toc h2 a,
  #toc h2 a:is(:link, :focus, :hover),
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
  #toc a.toplink {
    margin: 2px 0.5em 0;
  }
}

/* TOC layout for wide screens */
@media screen and (min-width: 930px) {
  body {
    padding-right: 360px;
    padding-right: calc(min(180px + 20%, 500px));
  }
  #toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 480px);
    width: 312px;
    margin: 0;
    padding: 0;
    z-index: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 2em;
    overflow: auto;
    overscroll-behavior: contain;
    scrollbar-width: thin;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
  #toc a.toplink {
    margin: 8px 0.5em 0;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre, .vcard {
    page-break-inside: avoid;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  :is(h2, h3, h4, h5, h6)+*, dd {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
}

/* Dark mode. */
@media (prefers-color-scheme: dark) {
:root {
  --background-color: #121212;
  --text-color: #f0f0f0;
  --title-color: #fff;
  --link-color: #4da4f0;
  --highlight-color: #282828;
  --line-color: #444;
  --pilcrow-weak: #444;
  --pilcrow-strong: #666;
  scrollbar-color: #777 #333;
}
}

/* SVG Trick: a prefix match works because only black and white are allowed */
svg :is([stroke="black"], [stroke^="#000"]) {
  stroke: var(--text-color);
}
svg :is([stroke="white"], [stroke^="#fff"]) {
  stroke: var(--background-color);
}
svg :is([fill="black"], [fill^="#000"], :not([fill])) {
  fill: var(--text-color);
}
svg :is([fill="white"], [fill^="#fff"]) {
  fill: var(--background-color);
}
</style>

</head>
<body class="xml2rfc">
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">DAP-Taskprov</td>
<td class="right">September 2025</td>
</tr></thead>
<tfoot><tr>
<td class="left">Wang &amp; Patton</td>
<td class="center">Expires 9 March 2026</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">Privacy Preserving Measurement</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-ietf-ppm-dap-taskprov-latest</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2025-09-05" class="published">5 September 2025</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Informational</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2026-03-09">9 March 2026</time></dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">S. Wang</div>
<div class="org">Apple Inc.</div>
</div>
<div class="author">
      <div class="author-name">C. Patton</div>
<div class="org">Cloudflare</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">Task Binding and In-Band Provisioning for DAP</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">An extension for the Distributed Aggregation Protocol (DAP) is specified that
cryptographically binds the parameters of a task to the task's execution. In
particular, when a client includes this extension with its report, the servers
will only aggregate the report if all parties agree on the task parameters.
This document also specifies an optional mechanism for in-band task
provisioning that builds on the report extension.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<section class="note rfcEditorRemove" id="section-note.1">
      <h2 id="name-about-this-document">
<a href="#name-about-this-document" class="section-name selfRef">About This Document</a>
      </h2>
<p id="section-note.1-1">This note is to be removed before publishing as an RFC.<a href="#section-note.1-1" class="pilcrow">¶</a></p>
<p id="section-note.1-2">
        The latest revision of this draft can be found at <span><a href="https://ietf-wg-ppm.github.io/draft-ietf-ppm-dap-taskprov/draft-ietf-ppm-dap-taskprov.html">https://ietf-wg-ppm.github.io/draft-ietf-ppm-dap-taskprov/draft-ietf-ppm-dap-taskprov.html</a></span>.
        Status information for this document may be found at <span><a href="https://datatracker.ietf.org/doc/draft-ietf-ppm-dap-taskprov/">https://datatracker.ietf.org/doc/draft-ietf-ppm-dap-taskprov/</a></span>.<a href="#section-note.1-2" class="pilcrow">¶</a></p>
<p id="section-note.1-3">
        Discussion of this document takes place on the
        Privacy Preserving Measurement Working Group mailing list (<span><a href="mailto:ppm@ietf.org">mailto:ppm@ietf.org</a></span>),
        which is archived at <span><a href="https://mailarchive.ietf.org/arch/browse/ppm/">https://mailarchive.ietf.org/arch/browse/ppm/</a></span>.
        Subscribe at <span><a href="https://www.ietf.org/mailman/listinfo/ppm/">https://www.ietf.org/mailman/listinfo/ppm/</a></span>.<a href="#section-note.1-3" class="pilcrow">¶</a></p>
<p id="section-note.1-4">Source for this draft and an issue tracker can be found at
        <span><a href="https://github.com/ietf-wg-ppm/draft-ietf-ppm-dap-taskprov">https://github.com/ietf-wg-ppm/draft-ietf-ppm-dap-taskprov</a></span>.<a href="#section-note.1-4" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 9 March 2026.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2025 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="auto internal xref">1</a>.  <a href="#name-introduction" class="internal xref">Introduction</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.1">
                <p id="section-toc.1-1.1.2.1.1" class="keepWithNext"><a href="#section-1.1" class="auto internal xref">1.1</a>.  <a href="#name-change-log" class="internal xref">Change Log</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1" class="keepWithNext"><a href="#section-2" class="auto internal xref">2</a>.  <a href="#name-conventions-and-definitions" class="internal xref">Conventions and Definitions</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="auto internal xref">3</a>.  <a href="#name-the-taskprov-extension" class="internal xref">The Taskprov Extension</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1"><a href="#section-3.1" class="auto internal xref">3.1</a>.  <a href="#name-task-encoding" class="internal xref">Task Encoding</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2">
                <p id="section-toc.1-1.3.2.2.1"><a href="#section-3.2" class="auto internal xref">3.2</a>.  <a href="#name-vdaf-config" class="internal xref">VDAF config</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2.2.1">
                    <p id="section-toc.1-1.3.2.2.2.1.1"><a href="#section-3.2.1" class="auto internal xref">3.2.1</a>.  <a href="#name-prio3count" class="internal xref">Prio3Count</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2.2.2">
                    <p id="section-toc.1-1.3.2.2.2.2.1"><a href="#section-3.2.2" class="auto internal xref">3.2.2</a>.  <a href="#name-prio3sum" class="internal xref">Prio3Sum</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2.2.3">
                    <p id="section-toc.1-1.3.2.2.2.3.1"><a href="#section-3.2.3" class="auto internal xref">3.2.3</a>.  <a href="#name-prio3sumvec" class="internal xref">Prio3SumVec</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2.2.4">
                    <p id="section-toc.1-1.3.2.2.2.4.1"><a href="#section-3.2.4" class="auto internal xref">3.2.4</a>.  <a href="#name-prio3histogram" class="internal xref">Prio3Histogram</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2.2.5">
                    <p id="section-toc.1-1.3.2.2.2.5.1"><a href="#section-3.2.5" class="auto internal xref">3.2.5</a>.  <a href="#name-prio3multihotcountvec" class="internal xref">Prio3MultihotCountVec</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2.2.6">
                    <p id="section-toc.1-1.3.2.2.2.6.1"><a href="#section-3.2.6" class="auto internal xref">3.2.6</a>.  <a href="#name-poplar1" class="internal xref">Poplar1</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.3">
                <p id="section-toc.1-1.3.2.3.1"><a href="#section-3.3" class="auto internal xref">3.3</a>.  <a href="#name-extensions" class="internal xref">Extensions</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="auto internal xref">4</a>.  <a href="#name-in-band-task-provisioning-w" class="internal xref">In-band Task Provisioning with the Taskprov Extension</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="auto internal xref">4.1</a>.  <a href="#name-overview" class="internal xref">Overview</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="auto internal xref">4.2</a>.  <a href="#name-task-advertisement" class="internal xref">Task Advertisement</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3">
                <p id="section-toc.1-1.4.2.3.1"><a href="#section-4.3" class="auto internal xref">4.3</a>.  <a href="#name-deriving-the-vdaf-verificat" class="internal xref">Deriving the VDAF Verification Key</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.4">
                <p id="section-toc.1-1.4.2.4.1"><a href="#section-4.4" class="auto internal xref">4.4</a>.  <a href="#name-opting-into-a-task" class="internal xref">Opting into a Task</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.5">
                <p id="section-toc.1-1.4.2.5.1"><a href="#section-4.5" class="auto internal xref">4.5</a>.  <a href="#name-client-behavior" class="internal xref">Client Behavior</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.6">
                <p id="section-toc.1-1.4.2.6.1"><a href="#section-4.6" class="auto internal xref">4.6</a>.  <a href="#name-leader-behavior" class="internal xref">Leader Behavior</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.6.2.1">
                    <p id="section-toc.1-1.4.2.6.2.1.1"><a href="#section-4.6.1" class="auto internal xref">4.6.1</a>.  <a href="#name-upload-protocol" class="internal xref">Upload Protocol</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.6.2.2">
                    <p id="section-toc.1-1.4.2.6.2.2.1"><a href="#section-4.6.2" class="auto internal xref">4.6.2</a>.  <a href="#name-aggregation-protocol" class="internal xref">Aggregation Protocol</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.6.2.3">
                    <p id="section-toc.1-1.4.2.6.2.3.1"><a href="#section-4.6.3" class="auto internal xref">4.6.3</a>.  <a href="#name-collection-protocol" class="internal xref">Collection Protocol</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.7">
                <p id="section-toc.1-1.4.2.7.1"><a href="#section-4.7" class="auto internal xref">4.7</a>.  <a href="#name-helper-behavior" class="internal xref">Helper Behavior</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.8">
                <p id="section-toc.1-1.4.2.8.1"><a href="#section-4.8" class="auto internal xref">4.8</a>.  <a href="#name-collector-behavior" class="internal xref">Collector Behavior</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="auto internal xref">5</a>.  <a href="#name-security-considerations" class="internal xref">Security Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="auto internal xref">6</a>.  <a href="#name-operational-considerations" class="internal xref">Operational Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="auto internal xref">7</a>.  <a href="#name-iana-considerations" class="internal xref">IANA Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1">
                <p id="section-toc.1-1.7.2.1.1"><a href="#section-7.1" class="auto internal xref">7.1</a>.  <a href="#name-report-extension" class="internal xref">Report Extension</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.2">
                <p id="section-toc.1-1.7.2.2.1"><a href="#section-7.2" class="auto internal xref">7.2</a>.  <a href="#name-registry-for-taskprov-exten" class="internal xref">Registry for Taskprov Extensions</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.3">
                <p id="section-toc.1-1.7.2.3.1"><a href="#section-7.3" class="auto internal xref">7.3</a>.  <a href="#name-dap-sub-namespace-for-dap" class="internal xref">DAP Sub-namespace for DAP</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="auto internal xref">8</a>.  <a href="#name-extending-this-document" class="internal xref">Extending this Document</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="auto internal xref">9</a>.  <a href="#name-normative-references" class="internal xref">Normative References</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#appendix-A" class="auto internal xref"></a><a href="#name-contributors" class="internal xref">Contributors</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#appendix-B" class="auto internal xref"></a><a href="#name-authors-addresses" class="internal xref">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">(RFC EDITOR: Remove this paragraph.) This draft is maintained in
https://github.com/ietf-wg-ppm/draft-ietf-ppm-dap-taskprov.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">The DAP protocol <span>[<a href="#DAP" class="cite xref">DAP</a>]</span> enables secure aggregation
of a set of reports submitted by Clients. This process is centered around a
"task" that determines, among other things, the cryptographic scheme to use for
the secure computation (a Verifiable Distributed Aggregation Function
<span>[<a href="#VDAF" class="cite xref">VDAF</a>]</span>), how reports are partitioned into
batches, and privacy parameters such as the minimum size of each batch. See
<span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-ppm-dap-16#section-4.2" class="relref">Section 4.2</a> of [<a href="#DAP" class="cite xref">DAP</a>]</span> for a complete listing.<a href="#section-1-2" class="pilcrow">¶</a></p>
<p id="section-1-3">In order to execute a task securely, it is required that all parties agree on
all parameters associated with the task. However, the core DAP specification
does not specify a mechanism for accomplishing this. In particular, it is
possible that the parties successfully aggregate and collect a batch, but some
party does not know the parameters that were enforced.<a href="#section-1-3" class="pilcrow">¶</a></p>
<p id="section-1-4">A desirable property for DAP to guarantee is that successful execution implies
agreement on the task parameters. On the other hand, disagreement between a
Client and the Aggregators should prevent reports uploaded by that Client from
being processed.<a href="#section-1-4" class="pilcrow">¶</a></p>
<p id="section-1-5"><a href="#definition" class="auto internal xref">Section 3</a> specifies a report extension (<span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-ppm-dap-16#section-4.5.3" class="relref">Section 4.5.3</a> of [<a href="#DAP" class="cite xref">DAP</a>]</span>) that
endows DAP with this property. First, it specifies an encoding of all task
parameters that are relevant to all parties. This excludes cryptographic
assets, such as the secret VDAF verification key (<span><a href="https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-vdaf-15#section-5" class="relref">Section 5</a> of [<a href="#VDAF" class="cite xref">VDAF</a>]</span>) or
the public HPKE configurations <span>[<a href="#RFC9180" class="cite xref">RFC9180</a>]</span> of the aggregators or collector.
Second, the task ID is computed by hashing the encoded parameters. If a report
includes the extension, then each aggregator checks if the task ID was computed
properly: if not, it rejects the report. This cryptographic binding of the task
to its parameters ensures that the report is only processed if the Client and
Aggregator agree on the task parameters.<a href="#section-1-5" class="pilcrow">¶</a></p>
<p id="section-1-6">One reason this task-binding property is desirable is that it makes the process
by which parties are provisioned with task parameters more robust. This is
because misconfiguration of a party would manifest in a server's telemetry as
report rejection. This is preferable to failing silently, as misconfiguration
could result in privacy loss.<a href="#section-1-6" class="pilcrow">¶</a></p>
<p id="section-1-7"><a href="#taskprov" class="auto internal xref">Section 4</a> specifies one possible mechanism for provisioning DAP tasks that
is built on top of the extension in <a href="#definition" class="auto internal xref">Section 3</a>. Its chief design goal is to
make task configuration completely in-band, via HTTP request headers. Note that
this mechanism is an optional feature of this specification; it is not required
to implement the DAP report extension in <a href="#definition" class="auto internal xref">Section 3</a>.<a href="#section-1-7" class="pilcrow">¶</a></p>
<div id="change-log">
<section id="section-1.1">
        <h3 id="name-change-log">
<a href="#section-1.1" class="section-number selfRef">1.1. </a><a href="#name-change-log" class="section-name selfRef">Change Log</a>
        </h3>
<p id="section-1.1-1">(RFC EDITOR: Remove this section.)<a href="#section-1.1-1" class="pilcrow">¶</a></p>
<p id="section-1.1-2">(*) Indicates a change that breaks wire compatibility with the previous draft.<a href="#section-1.1-2" class="pilcrow">¶</a></p>
<p id="section-1.1-3">02:<a href="#section-1.1-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.1-4.1">
            <p id="section-1.1-4.1.1">Don't specify a lower limit for vector bounds.<a href="#section-1.1-4.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-4.2">
            <p id="section-1.1-4.2.1">Update normative references.<a href="#section-1.1-4.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-4.3">
            <p id="section-1.1-4.3.1">Recommend including the report extension in the public extensions list.<a href="#section-1.1-4.3.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-1.1-5">01:<a href="#section-1.1-5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.1-6.1">
            <p id="section-1.1-6.1.1">Add an extension point to the <code>TaskConfig</code> structure and define rules for
processing extensions. (*)<a href="#section-1.1-6.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-6.2">
            <p id="section-1.1-6.2.1">Remove DP mechanisms. (*)<a href="#section-1.1-6.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-6.3">
            <p id="section-1.1-6.3.1">Add guidelines for extending this document to account for new VDAFs or DAP
batch modes. Improve the extension points for these in <code>TaskConfig</code> in order
to make this easier. (*)<a href="#section-1.1-6.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-6.4">
            <p id="section-1.1-6.4.1">Add a salt to the task ID computation. (*)<a href="#section-1.1-6.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-6.5">
            <p id="section-1.1-6.5.1">Harmonize task lifetime parameters with <span>[<a href="#DAP" class="cite xref">DAP</a>]</span> by adding a task start time
and replacing the task end time with a task duration. (*)<a href="#section-1.1-6.5.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-6.6">
            <p id="section-1.1-6.6.1">Harmonize batch mode parameters with <span>[<a href="#DAP" class="cite xref">DAP</a>]</span> by removing the deprecated
<code>max_batch_query_count</code> and <code>max_batch_size</code> parameters. (*)<a href="#section-1.1-6.6.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-6.7">
            <p id="section-1.1-6.7.1">Task provisioning: Remove guidance for per-task HPKE configurations, as this
feature was deprecated by DAP.<a href="#section-1.1-6.7.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-6.8">
            <p id="section-1.1-6.8.1">Bump draft-ietf-ppm-dap-12 to 13 <span>[<a href="#DAP" class="cite xref">DAP</a>]</span>. (*)<a href="#section-1.1-6.8.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-6.9">
            <p id="section-1.1-6.9.1">Bump draft-irtf-cfrg-vdaf-12 to 13 <span>[<a href="#VDAF" class="cite xref">VDAF</a>]</span>.<a href="#section-1.1-6.9.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
</section>
</div>
<div id="conventions-and-definitions">
<section id="section-2">
      <h2 id="name-conventions-and-definitions">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-conventions-and-definitions" class="section-name selfRef">Conventions and Definitions</a>
      </h2>
<p id="section-2-1">The key words "<span class="bcp14">MUST</span>", "<span class="bcp14">MUST NOT</span>", "<span class="bcp14">REQUIRED</span>", "<span class="bcp14">SHALL</span>", "<span class="bcp14">SHALL NOT</span>", "<span class="bcp14">SHOULD</span>", "<span class="bcp14">SHOULD NOT</span>", "<span class="bcp14">RECOMMENDED</span>", "<span class="bcp14">NOT RECOMMENDED</span>",
"<span class="bcp14">MAY</span>", and "<span class="bcp14">OPTIONAL</span>" in this document are to be interpreted as
described in BCP 14 <span>[<a href="#RFC2119" class="cite xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="cite xref">RFC8174</a>]</span> when, and only when, they
appear in all capitals, as shown here.<a href="#section-2-1" class="pilcrow">¶</a></p>
<p id="section-2-2">This document uses the same conventions for error handling as <span>[<a href="#DAP" class="cite xref">DAP</a>]</span>. In
addition, this document extends the core specification by adding the following
error types:<a href="#section-2-2" class="pilcrow">¶</a></p>
<div id="urn-space-errors">
<table class="center" id="table-1">
        <caption><a href="#table-1" class="selfRef">Table 1</a></caption>
<thead>
          <tr>
            <th class="text-left" rowspan="1" colspan="1">Type</th>
            <th class="text-left" rowspan="1" colspan="1">Description</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">invalidTask</td>
            <td class="text-left" rowspan="1" colspan="1">An Aggregator has opted out of the indicated task as described in <a href="#provisioning-a-task" class="auto internal xref">Section 4.4</a>
</td>
          </tr>
        </tbody>
      </table>
</div>
<p id="section-2-4">The terms used follow those described in <span>[<a href="#DAP" class="cite xref">DAP</a>]</span>. The following new terms are
used:<a href="#section-2-4" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-2-5">
        <dt id="section-2-5.1">Task configuration:</dt>
        <dd style="margin-left: 1.5em" id="section-2-5.2">
          <p id="section-2-5.2.1">The non-secret parameters of a task.<a href="#section-2-5.2.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
<dt id="section-2-5.3">Task author:</dt>
        <dd style="margin-left: 1.5em" id="section-2-5.4">
          <p id="section-2-5.4.1">The entity that defines a task's configuration in the provisioning mechanism of <a href="#taskprov" class="auto internal xref">Section 4</a>.<a href="#section-2-5.4.1" class="pilcrow">¶</a></p>
</dd>
      <dd class="break"></dd>
</dl>
</section>
</div>
<div id="definition">
<section id="section-3">
      <h2 id="name-the-taskprov-extension">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-the-taskprov-extension" class="section-name selfRef">The Taskprov Extension</a>
      </h2>
<p id="section-3-1">To use the Taskprov extension, the Client includes the following extension in
the report extensions for each Aggregator as described in <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-ppm-dap-16#section-4.5.3" class="relref">Section 4.5.3</a> of [<a href="#DAP" class="cite xref">DAP</a>]</span>:<a href="#section-3-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3-2">
<pre>
enum {
    taskprov(0xff00),
    (2^16-1)
} ExtensionType;
</pre><a href="#section-3-2" class="pilcrow">¶</a>
</div>
<p id="section-3-3">The payload of the extension <span class="bcp14">MUST</span> be empty. If the payload is non-empty, then
the Aggregator <span class="bcp14">MUST</span> reject the report.<a href="#section-3-3" class="pilcrow">¶</a></p>
<p id="section-3-4">When the client uses the Taskprov extension, it computes the task ID (<span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-ppm-dap-16#section-4.2" class="relref">Section 4.2</a> of [<a href="#DAP" class="cite xref">DAP</a>]</span>) as follows:<a href="#section-3-4" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3-5">
<pre>
task_id = SHA-256(SHA-256("dap-taskprov task id") || task_config)
</pre><a href="#section-3-5" class="pilcrow">¶</a>
</div>
<p id="section-3-6">where <code>task_config</code> is a <code>TaskConfig</code> structure defined in <a href="#task-encoding" class="auto internal xref">Section 3.1</a>.
Function SHA-256() is as defined in <span>[<a href="#SHS" class="cite xref">SHS</a>]</span>.<a href="#section-3-6" class="pilcrow">¶</a></p>
<p id="section-3-7">The task ID is bound to each report share (via HPKE authenticated and
associated data, see <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-ppm-dap-16#section-4.5.2" class="relref">Section 4.5.2</a> of [<a href="#DAP" class="cite xref">DAP</a>]</span>). Binding the parameters to the
ID this way ensures, in turn, that the report is only aggregated if the Client
and Aggregator agree on the parameters. This is accomplished by the Aggregator
behavior below.<a href="#section-3-7" class="pilcrow">¶</a></p>
<p id="section-3-8">During aggregation (<span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-ppm-dap-16#section-4.6" class="relref">Section 4.6</a> of [<a href="#DAP" class="cite xref">DAP</a>]</span>), each Aggregator processes a
report with the Taskprov extension as follows.<a href="#section-3-8" class="pilcrow">¶</a></p>
<p id="section-3-9">First, it looks up the ID and parameters associated with the task. Note the
task has already been configured; otherwise the Aggregator would have already
aborted the request due to not recognizing the task.<a href="#section-3-9" class="pilcrow">¶</a></p>
<p id="section-3-10">Next, the Aggregator encodes the parameters as a <code>TaskConfig</code> defined in
<a href="#task-encoding" class="auto internal xref">Section 3.1</a> and computes the task ID as above. If the derived task ID
does not match the task ID of the request, then it <span class="bcp14">MUST</span> reject the report with
error "invalid_message".<a href="#section-3-10" class="pilcrow">¶</a></p>
<p id="section-3-11">During the upload interaction (<span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-ppm-dap-16#section-4.5" class="relref">Section 4.5</a> of [<a href="#DAP" class="cite xref">DAP</a>]</span>), the Leader <span class="bcp14">SHOULD</span>
abort the request with "unrecognizedTask" if the derived task ID does not match
the task ID of the request.<a href="#section-3-11" class="pilcrow">¶</a></p>
<div id="task-encoding">
<section id="section-3.1">
        <h3 id="name-task-encoding">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-task-encoding" class="section-name selfRef">Task Encoding</a>
        </h3>
<p id="section-3.1-1">The task configuration is encoded as follows:<a href="#section-3.1-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.1-2">
<pre>
uint32 VdafType; /* As defined in Section 10 of [VDAF] */

struct {
    /* Info specific for a task. */
    opaque task_info&lt;1..2^8-1&gt;;

    /* Leader API endpoint. */
    Url leader_aggregator_endpoint;

    /* Helper API endpoint. */
    Url helper_aggregator_endpoint;

    /* Time precision. */
    Duration time_precision;

    /* Minimum batch size. */
    uint32 min_batch_size;

    /* The batch mode and its parameters. */
    BatchMode batch_mode;
    opaque batch_config&lt;0..2^16-1&gt;;

    /* The earliest timestamp that will be accepted for this task. */
    Time task_start;

    /* The duration of the task. */
    Duration task_duration;

    /* Determines the VDAF type and its config parameters. */
    VdafType vdaf_type;
    opaque vdaf_config&lt;0..2^16-1&gt;;

    /* Taskprov Extensions. */
    TaskprovExtension extensions&lt;0..2^16-1&gt;;
} TaskConfig;
</pre><a href="#section-3.1-2" class="pilcrow">¶</a>
</div>
<p id="section-3.1-3">The purpose of <code>TaskConfig</code> is to define all parameters that are necessary for
configuring each party. It includes all parameters listed in <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-ppm-dap-16#section-4.2" class="relref">Section 4.2</a> of [<a href="#DAP" class="cite xref">DAP</a>]</span> as well as two additional fields:<a href="#section-3.1-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.1-4.1">
            <p id="section-3.1-4.1.1"><code>task_info</code> is an opaque field whose contents are specific to the deployment.
For example, this might be a human-readable string describing the purpose of
this task.<a href="#section-3.1-4.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-3.1-4.2">
            <p id="section-3.1-4.2.1"><code>extensions</code> is a list of extensions to this document. The format and
semantics of extensions are describe in <a href="#taskprov-extensions" class="auto internal xref">Section 3.3</a>.<a href="#section-3.1-4.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-3.1-5">This structure does not include cryptographic assets shared by only a subset of
the parties, including the secret VDAF verification key <span>[<a href="#VDAF" class="cite xref">VDAF</a>]</span> or public
HPKE configurations <span>[<a href="#RFC9180" class="cite xref">RFC9180</a>]</span>.<a href="#section-3.1-5" class="pilcrow">¶</a></p>
<p id="section-3.1-6">The <code>batch_mode</code> field indicates the DAP batch mode and corresponds to a
codepoint in the Batch Modes Registry.<a href="#section-3.1-6" class="pilcrow">¶</a></p>
<ul class="normal ulEmpty">
<li class="normal ulEmpty" id="section-3.1-7.1">
            <p id="section-3.1-7.1.1">TODO Add a reference to the IANA registry for batch modes created by
<span>[<a href="#DAP" class="cite xref">DAP</a>]</span>.<a href="#section-3.1-7.1.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-3.1-8">The <code>batch_config</code> field contains any parameters that are required for
configuring the batch mode. For the time-interval and leader-selected batch
modes specified in <span>[<a href="#DAP" class="cite xref">DAP</a>]</span>, the payload is empty. Batch modes defined by
future documents may specify a non-empty payload; see <a href="#extending-this-doc" class="auto internal xref">Section 8</a>
for details. The length prefix of the <code>batch_config</code> ensures that the batch
config can be decoded even if the batch mode is unrecognized.<a href="#section-3.1-8" class="pilcrow">¶</a></p>
<p id="section-3.1-9">The <code>vdaf_type</code> field indicates the VDAF for the task and corresponds to a
codepoint in the VDAF Identifiers registry.<a href="#section-3.1-9" class="pilcrow">¶</a></p>
<ul class="normal ulEmpty">
<li class="normal ulEmpty" id="section-3.1-10.1">
            <p id="section-3.1-10.1.1">TODO: Add a reference to the IANA registry created by <span>[<a href="#VDAF" class="cite xref">VDAF</a>]</span>.<a href="#section-3.1-10.1.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-3.1-11">The <code>vdaf_config</code> field contains parameters necessary to configure an instance
of the VDAF. <a href="#vdaf-config" class="auto internal xref">Section 3.2</a> defines a suitable encoding of the configuration
for each VDAF specified in <span>[<a href="#VDAF" class="cite xref">VDAF</a>]</span>. VDAFs defined by future documents may
also use this field as well; see <a href="#extending-this-doc" class="auto internal xref">Section 8</a> for details.<a href="#section-3.1-11" class="pilcrow">¶</a></p>
<p id="section-3.1-12">The length prefix of the <code>vdaf_config</code> ensures that VDAF config can be decoded
even if the VDAF type is not recognized.<a href="#section-3.1-12" class="pilcrow">¶</a></p>
<p id="section-3.1-13">The definition of <code>Time</code>, <code>Duration</code>, <code>Url</code>, and <code>BatchMode</code> follow those in
<span>[<a href="#DAP" class="cite xref">DAP</a>]</span>.<a href="#section-3.1-13" class="pilcrow">¶</a></p>
</section>
</div>
<div id="vdaf-config">
<section id="section-3.2">
        <h3 id="name-vdaf-config">
<a href="#section-3.2" class="section-number selfRef">3.2. </a><a href="#name-vdaf-config" class="section-name selfRef">VDAF config</a>
        </h3>
<p id="section-3.2-1">This section defines the payload of <code>TaskConfig.vdaf_config</code> for each VDAF
specified in <span>[<a href="#VDAF" class="cite xref">VDAF</a>]</span>. In some cases, the VDAF supports more than two
Aggregators; but since DAP only supports two Aggregators, we do not include the
number of Aggregators in the encoding.<a href="#section-3.2-1" class="pilcrow">¶</a></p>
<div id="prio3count">
<section id="section-3.2.1">
          <h4 id="name-prio3count">
<a href="#section-3.2.1" class="section-number selfRef">3.2.1. </a><a href="#name-prio3count" class="section-name selfRef">Prio3Count</a>
          </h4>
<p id="section-3.2.1-1">The payload is empty.<a href="#section-3.2.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="prio3sum">
<section id="section-3.2.2">
          <h4 id="name-prio3sum">
<a href="#section-3.2.2" class="section-number selfRef">3.2.2. </a><a href="#name-prio3sum" class="section-name selfRef">Prio3Sum</a>
          </h4>
<div class="alignLeft art-text artwork" id="section-3.2.2-1">
<pre>
struct {
    uint32 max_measurement; /* largest summand */
} Prio3SumConfig;
</pre><a href="#section-3.2.2-1" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="prio3sumvec">
<section id="section-3.2.3">
          <h4 id="name-prio3sumvec">
<a href="#section-3.2.3" class="section-number selfRef">3.2.3. </a><a href="#name-prio3sumvec" class="section-name selfRef">Prio3SumVec</a>
          </h4>
<div class="alignLeft art-text artwork" id="section-3.2.3-1">
<pre>
struct {
    uint32 length;       /* length of the vector */
    uint8 bits;          /* bit length of each summand */
    uint32 chunk_length; /* size of each proof chunk */
} Prio3SumVecConfig;
</pre><a href="#section-3.2.3-1" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="prio3histogram">
<section id="section-3.2.4">
          <h4 id="name-prio3histogram">
<a href="#section-3.2.4" class="section-number selfRef">3.2.4. </a><a href="#name-prio3histogram" class="section-name selfRef">Prio3Histogram</a>
          </h4>
<div class="alignLeft art-text artwork" id="section-3.2.4-1">
<pre>
struct {
    uint32 length;       /* number of buckets */
    uint32 chunk_length; /* size of each proof chunk */
} Prio3HistogramConfig;
</pre><a href="#section-3.2.4-1" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="prio3multihotcountvec">
<section id="section-3.2.5">
          <h4 id="name-prio3multihotcountvec">
<a href="#section-3.2.5" class="section-number selfRef">3.2.5. </a><a href="#name-prio3multihotcountvec" class="section-name selfRef">Prio3MultihotCountVec</a>
          </h4>
<div class="alignLeft art-text artwork" id="section-3.2.5-1">
<pre>
struct {
    uint32 length;       /* length of the vector */
    uint32 chunk_length; /* size of each proof chunk */
    uint32 max_weight;   /* largest vector weight /
} Prio3MultihotCountVecConfig;
</pre><a href="#section-3.2.5-1" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="poplar1">
<section id="section-3.2.6">
          <h4 id="name-poplar1">
<a href="#section-3.2.6" class="section-number selfRef">3.2.6. </a><a href="#name-poplar1" class="section-name selfRef">Poplar1</a>
          </h4>
<div class="alignLeft art-text artwork" id="section-3.2.6-1">
<pre>
struct {
    uint16 bits; /* bit length of the input string */
} Poplar1Config;
</pre><a href="#section-3.2.6-1" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="taskprov-extensions">
<section id="section-3.3">
        <h3 id="name-extensions">
<a href="#section-3.3" class="section-number selfRef">3.3. </a><a href="#name-extensions" class="section-name selfRef">Extensions</a>
        </h3>
<p id="section-3.3-1">The <code>TaskConfig</code> structure includes a list of extensions. In general,
extensions can be used to bind additional, application-specific information to
the task. For example, an extension might be used to encode the identity of the
Collector. (Only the Aggregators are identified in <code>TaskConfig</code>.)<a href="#section-3.3-1" class="pilcrow">¶</a></p>
<p id="section-3.3-2">Each extension is structured as follows:<a href="#section-3.3-2" class="pilcrow">¶</a></p>
<div class="lang-tls-presentation sourcecode" id="section-3.3-3">
<pre>
struct {
  TaskprovExtensionType extension_type;
  opaque extension_data&lt;0..2^16-1&gt;;
} TaskprovExtension;

enum {
  reserved(0),
  (2^16-1)
} TaskprovExtensionType;
</pre><a href="#section-3.3-3" class="pilcrow">¶</a>
</div>
<p id="section-3.3-4">The <code>extension_type</code> identifies the extension and <code>extension_data</code> is
structured as specified by the extension.<a href="#section-3.3-4" class="pilcrow">¶</a></p>
<p id="section-3.3-5">Extensions are treated as mandatory-to-implement in the protocol described in
<a href="#taskprov" class="auto internal xref">Section 4</a>. In particular, protocols participants <span class="bcp14">MUST</span> opt-out of tasks
containing unrecognized extensions. See <a href="#provisioning-a-task" class="auto internal xref">Section 4.4</a>.<a href="#section-3.3-5" class="pilcrow">¶</a></p>
<p id="section-3.3-6">If the same extension type appears more than once among the Taskprov extensions
in the <code>TaskConfig</code> structure, then protocols participants <span class="bcp14">MUST</span> opt-out of tasks
with repeated extensions.<a href="#section-3.3-6" class="pilcrow">¶</a></p>
<p id="section-3.3-7">Note that Taskprov extensions are semantically distinct from DAP report
extensions and do not share the same codepoint registry
(<a href="#taskprov-extension-registry" class="auto internal xref">Section 7.2</a>). Future documents may want to define both a
Taskprov extension and a report extension, but there may also be situations
where a document defines one but not the other.<a href="#section-3.3-7" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="taskprov">
<section id="section-4">
      <h2 id="name-in-band-task-provisioning-w">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-in-band-task-provisioning-w" class="section-name selfRef">In-band Task Provisioning with the Taskprov Extension</a>
      </h2>
<p id="section-4-1">Before a task can be executed, it is necessary to first provision the Clients,
Aggregators, and Collector with the task's configuration. The core DAP
specification does not define a mechanism for provisioning tasks. This section
describes a mechanism whose key feature is that task configuration is
performed completely in-band, via HTTP request headers.<a href="#section-4-1" class="pilcrow">¶</a></p>
<p id="section-4-2">This method presumes the existence of a logical "task author" (written as
"Author" hereafter) who is capable of pushing configurations to Clients. All
parameters required by downstream entities (the Aggregators) are carried by HTTP
headers piggy-backed on the protocol flow.<a href="#section-4-2" class="pilcrow">¶</a></p>
<p id="section-4-3">This mechanism is designed with the same security and privacy considerations of
the core DAP protocol. The Author is not regarded as a trusted third party: it
is incumbent on all protocol participants to verify the task configuration
disseminated by the Author and opt-out if the parameters are deemed insufficient
for privacy. In particular, adopters of this mechanism should presume the
Author is under the adversary's control. In fact, we expect in a real-world
deployment that the Author may be co-located with the Collector.<a href="#section-4-3" class="pilcrow">¶</a></p>
<p id="section-4-4">The DAP protocol also requires configuring the entities with a variety of assets
that are not task-specific, but are important for establishing
Client-Aggregator, Collector-Aggregator, and Aggregator-Aggregator
relationships. These include:<a href="#section-4-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4-5.1">
          <p id="section-4-5.1.1">The Collector's HPKE <span>[<a href="#RFC9180" class="cite xref">RFC9180</a>]</span> configuration used by the Aggregators to
encrypt aggregate shares.<a href="#section-4-5.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-4-5.2">
          <p id="section-4-5.2.1">Any assets required for authenticating HTTP requests.<a href="#section-4-5.2.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-4-6">This section does not specify a mechanism for provisioning these assets; as in
the core DAP protocol; these are presumed to be configured out-of-band.<a href="#section-4-6" class="pilcrow">¶</a></p>
<p id="section-4-7">Note that we consider the VDAF verification key <span>[<a href="#VDAF" class="cite xref">VDAF</a>]</span>, used by the
Aggregators to aggregate reports, to be a task-specific asset. This document
specifies how to derive this key for a given task from a pre-shared secret,
which in turn is presumed to be configured out-of-band.<a href="#section-4-7" class="pilcrow">¶</a></p>
<div id="overview">
<section id="section-4.1">
        <h3 id="name-overview">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-overview" class="section-name selfRef">Overview</a>
        </h3>
<p id="section-4.1-1">The process of provisioning a task begins when the Author disseminates the task
configuration to the Collector and each of the Clients. When a Client issues an
upload request to the Leader (as described in <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-ppm-dap-16#section-4.5" class="relref">Section 4.5</a> of [<a href="#DAP" class="cite xref">DAP</a>]</span>), it
includes in an HTTP header the task configuration it used to generate the
report. We refer to this process as "task advertisement". Before consuming the
report, the Leader parses the configuration and decides whether to opt-in; if
not, the task's execution halts.<a href="#section-4.1-1" class="pilcrow">¶</a></p>
<p id="section-4.1-2">Otherwise, if the Leader does opt-in, it advertises the task to the Helper
during the aggregation interaction (<span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-ppm-dap-16#section-4.6" class="relref">Section 4.6</a> of [<a href="#DAP" class="cite xref">DAP</a>]</span>). In particular, it
includes the task configuration in an HTTP header of each aggregation job
request for that task. Before proceeding, the Helper must first parse the
configuration and decide whether to opt-in; if not, the task's execution halts.<a href="#section-4.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="task-advertisement">
<section id="section-4.2">
        <h3 id="name-task-advertisement">
<a href="#section-4.2" class="section-number selfRef">4.2. </a><a href="#name-task-advertisement" class="section-name selfRef">Task Advertisement</a>
        </h3>
<p id="section-4.2-1">To advertise a task to its peer, a protocol participant includes a header
"dap-taskprov" with an HTTP request incident to the task execution. The value
is the <code>TaskConfig</code> structure defined <a href="#task-encoding" class="auto internal xref">Section 3.1</a>, expanded into its
URL-safe, unpadded Base 64 representation as specified in Sections <a href="https://rfc-editor.org/rfc/rfc4648#section-5" class="relref">5</a> and <a href="https://rfc-editor.org/rfc/rfc4648#section-3.2" class="relref">3.2</a> of <span>[<a href="#RFC4648" class="cite xref">RFC4648</a>]</span>.<a href="#section-4.2-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="vdaf-verify-key">
<section id="section-4.3">
        <h3 id="name-deriving-the-vdaf-verificat">
<a href="#section-4.3" class="section-number selfRef">4.3. </a><a href="#name-deriving-the-vdaf-verificat" class="section-name selfRef">Deriving the VDAF Verification Key</a>
        </h3>
<p id="section-4.3-1">When a Leader and Helper implement this mechanism, they <span class="bcp14">SHOULD</span> compute the
shared VDAF verification key <span>[<a href="#VDAF" class="cite xref">VDAF</a>]</span> as described in this section.<a href="#section-4.3-1" class="pilcrow">¶</a></p>
<p id="section-4.3-2">The Aggregators are presumed to have securely exchanged a pre-shared secret
out-of-band. The length of this secret <span class="bcp14">MUST</span> be 32 bytes. Let us denote this
secret by <code>verify_key_init</code>.<a href="#section-4.3-2" class="pilcrow">¶</a></p>
<p id="section-4.3-3">Let <code>VERIFY_KEY_SIZE</code> denote the length of the verification key for the VDAF
indicated by the task configuration. (See <span>[<a href="#VDAF" class="cite xref">VDAF</a>], <a href="https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-vdaf-15#section-5" class="relref">Section 5</a></span>.)<a href="#section-4.3-3" class="pilcrow">¶</a></p>
<p id="section-4.3-4">The VDAF verification key used for the task is computed as follows:<a href="#section-4.3-4" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.3-5">
<pre>
verify_key = HKDF-Expand(
    HKDF-Extract(
        SHA-256("dap-taskprov"), # salt
        verify_key_init,         # IKM
    ),
    task_id,                     # info
    VERIFY_KEY_SIZE,             # L
)
</pre><a href="#section-4.3-5" class="pilcrow">¶</a>
</div>
<p id="section-4.3-6">where <code>task_id</code> is as defined in <a href="#definition" class="auto internal xref">Section 3</a>. Functions HKDF-Extract() and
HKDF-Expand() are as defined in <span>[<a href="#RFC5869" class="cite xref">RFC5869</a>]</span>. Both functions are instantiated
with <code>SHA-256()</code> as defined in <span>[<a href="#SHS" class="cite xref">SHS</a>]</span>.<a href="#section-4.3-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="provisioning-a-task">
<section id="section-4.4">
        <h3 id="name-opting-into-a-task">
<a href="#section-4.4" class="section-number selfRef">4.4. </a><a href="#name-opting-into-a-task" class="section-name selfRef">Opting into a Task</a>
        </h3>
<p id="section-4.4-1">Prior to participating in a task, each protocol participant must determine if
the <code>TaskConfig</code> disseminated by the Author can be configured. The participant
is said to "opt in" to the task if the derived task ID (see
<a href="#definition" class="auto internal xref">Section 3</a>) corresponds to an already configured task or the task ID
is unrecognized and therefore corresponds to a new task.<a href="#section-4.4-1" class="pilcrow">¶</a></p>
<p id="section-4.4-2">A protocol participant <span class="bcp14">MAY</span> "opt out" of a task if:<a href="#section-4.4-2" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-4.4-3">
<li id="section-4.4-3.1">
            <p id="section-4.4-3.1.1">The derived task ID corresponds to an already configured task, but the task
configuration disseminated by the Author does not match the existing
configuration.<a href="#section-4.4-3.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-4.4-3.2">
            <p id="section-4.4-3.2.1">The VDAF config or other parameters are deemed insufficient for privacy.<a href="#section-4.4-3.2.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-4.4-3.3">
            <p id="section-4.4-3.3.1">A secure connection to one or both of the Aggregator endpoints could not be
established.<a href="#section-4.4-3.3.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-4.4-3.4">
            <p id="section-4.4-3.4.1">The task lifetime is too long.<a href="#section-4.4-3.4.1" class="pilcrow">¶</a></p>
</li>
        </ol>
<p id="section-4.4-4">A protocol participant <span class="bcp14">MUST</span> opt out if:<a href="#section-4.4-4" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-4.4-5">
<li id="section-4.4-5.1">
            <p id="section-4.4-5.1.1">The task has ended.<a href="#section-4.4-5.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-4.4-5.2">
            <p id="section-4.4-5.2.1">The DAP batch mode or VDAF is not implemented.<a href="#section-4.4-5.2.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-4.4-5.3">
            <p id="section-4.4-5.3.1">One of the extensions is not recognized.<a href="#section-4.4-5.3.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-4.4-5.4">
            <p id="section-4.4-5.4.1">One of the extension types appear more than once.<a href="#section-4.4-5.4.1" class="pilcrow">¶</a></p>
</li>
        </ol>
<p id="section-4.4-6">The behavior of each protocol participant is determined by whether or not they
opt in to a task.<a href="#section-4.4-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="client-behavior">
<section id="section-4.5">
        <h3 id="name-client-behavior">
<a href="#section-4.5" class="section-number selfRef">4.5. </a><a href="#name-client-behavior" class="section-name selfRef">Client Behavior</a>
        </h3>
<p id="section-4.5-1">Upon receiving a <code>TaskConfig</code> from the Author, the Client decides whether to
opt into the task as described in <a href="#provisioning-a-task" class="auto internal xref">Section 4.4</a>. If the Client opts
out, it <span class="bcp14">MUST NOT</span> attempt to upload reports for the task.<a href="#section-4.5-1" class="pilcrow">¶</a></p>
<p id="section-4.5-2">Once the client opts into a task, it may begin uploading reports for the task to
the Leader. The extension codepoint <code>taskprov</code> <span class="bcp14">MUST</span> be offered in both the
Leader and the Helper's report extensions. The extension may be included in
either the public or private report extensions; it is <span class="bcp14">RECOMMENDED</span> that the
extension be included in the public extensions. In addition, each report's task
ID <span class="bcp14">MUST</span> be computed as described in <a href="#definition" class="auto internal xref">Section 3</a>.<a href="#section-4.5-2" class="pilcrow">¶</a></p>
<p id="section-4.5-3">The Client <span class="bcp14">SHOULD</span> advertise the task configuration by specifying the encoded
<code>TaskConfig</code> described in <a href="#definition" class="auto internal xref">Section 3</a> in the "dap-taskprov" HTTP header, but
<span class="bcp14">MAY</span> choose to omit this header in order to save network bandwidth. However, the
Leader may respond with "unrecognizedTask" if it has not been configured with
this task. In this case, the Client <span class="bcp14">MUST</span> retry the upload request with the
"dap-taskprov" HTTP header.<a href="#section-4.5-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="leader-behavior">
<section id="section-4.6">
        <h3 id="name-leader-behavior">
<a href="#section-4.6" class="section-number selfRef">4.6. </a><a href="#name-leader-behavior" class="section-name selfRef">Leader Behavior</a>
        </h3>
<div id="upload-protocol">
<section id="section-4.6.1">
          <h4 id="name-upload-protocol">
<a href="#section-4.6.1" class="section-number selfRef">4.6.1. </a><a href="#name-upload-protocol" class="section-name selfRef">Upload Protocol</a>
          </h4>
<p id="section-4.6.1-1">Upon receiving a Client report, if the Leader does not support the <a href="#taskprov" class="auto internal xref">Section 4</a>
mechanism, it will ignore the "dap-taskprov" HTTP header. In particular, if the
task ID is not recognized, then it <span class="bcp14">MUST</span> abort the upload request with
"unrecognizedTask".<a href="#section-4.6.1-1" class="pilcrow">¶</a></p>
<p id="section-4.6.1-2">Otherwise, if the Leader does support this mechanism, it first checks if the
"dap-taskprov" HTTP header is specified. If not present, that means the Client
has skipped task advertisement. If the Leader recognizes the task ID, it will
include the client report in the aggregation of that task ID. Otherwise, it
<span class="bcp14">MUST</span> abort with "unrecognizedTask". The Client will then retry with the task
advertisement.<a href="#section-4.6.1-2" class="pilcrow">¶</a></p>
<p id="section-4.6.1-3">If the Client advertises the task, the Leader checks that the task ID indicated
by the upload request matches the task ID derived from the "dap-taskprov" HTTP
header as specified in <a href="#definition" class="auto internal xref">Section 3</a>. If the task ID does not match, then the
Leader <span class="bcp14">MUST</span> abort with "unrecognizedTask".<a href="#section-4.6.1-3" class="pilcrow">¶</a></p>
<p id="section-4.6.1-4">The Leader then decides whether to opt in to the task as described in
<a href="#provisioning-a-task" class="auto internal xref">Section 4.4</a>. If it opts out, it <span class="bcp14">MUST</span> abort the upload request with
"invalidTask".<a href="#section-4.6.1-4" class="pilcrow">¶</a></p>
<p id="section-4.6.1-5">Finally, once the Leader has opted in to the task, it completes the upload
request as usual.<a href="#section-4.6.1-5" class="pilcrow">¶</a></p>
<p id="section-4.6.1-6">During the upload flow, if the Leader's report share does not present a
<code>taskprov</code> extension type, the Leader <span class="bcp14">MUST</span> abort the upload request with
"invalidMessage".<a href="#section-4.6.1-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="aggregation-protocol">
<section id="section-4.6.2">
          <h4 id="name-aggregation-protocol">
<a href="#section-4.6.2" class="section-number selfRef">4.6.2. </a><a href="#name-aggregation-protocol" class="section-name selfRef">Aggregation Protocol</a>
          </h4>
<p id="section-4.6.2-1">When the Leader opts in to a task, it <span class="bcp14">SHOULD</span> derive the VDAF verification key
for that task as described in <a href="#vdaf-verify-key" class="auto internal xref">Section 4.3</a>. The Leader <span class="bcp14">MUST</span> advertise
the task to the Helper in every request incident to the task as described in
<a href="#definition" class="auto internal xref">Section 3</a>.<a href="#section-4.6.2-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="collection-protocol">
<section id="section-4.6.3">
          <h4 id="name-collection-protocol">
<a href="#section-4.6.3" class="section-number selfRef">4.6.3. </a><a href="#name-collection-protocol" class="section-name selfRef">Collection Protocol</a>
          </h4>
<p id="section-4.6.3-1">The Collector might create a collection job for a task provisioned by this
mechanism prior to opting into the task. In this case, the Leader would need to
abort the collect request with "unrecognizedTask". When it does so, it is up to
the Collector to retry its request.<a href="#section-4.6.3-1" class="pilcrow">¶</a></p>
<ul class="normal ulEmpty">
<li class="normal ulEmpty" id="section-4.6.3-2.1">
              <p id="section-4.6.3-2.1.1">OPEN ISSUE: This semantics is awkward, as there's no way for the Leader to
distinguish between Collectors who support this mechanism and those that don't.<a href="#section-4.6.3-2.1.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-4.6.3-3">The Leader <span class="bcp14">MUST</span> advertise the task in every aggregate share request issued to
the Helper as described in <a href="#task-advertisement" class="auto internal xref">Section 4.2</a>.<a href="#section-4.6.3-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="helper-behavior">
<section id="section-4.7">
        <h3 id="name-helper-behavior">
<a href="#section-4.7" class="section-number selfRef">4.7. </a><a href="#name-helper-behavior" class="section-name selfRef">Helper Behavior</a>
        </h3>
<p id="section-4.7-1">The Leader advertises a task to the Helper during each step of an aggregation
job and when it requests the Helper's aggregate share during a collection job.<a href="#section-4.7-1" class="pilcrow">¶</a></p>
<p id="section-4.7-2">Upon receiving a task advertisement from the Leader, If the Helper does not
support this mechanism, it will ignore the "dap-taskprov" HTTP header and
process the request as usual. In particular, if the Helper does not recognize
the task ID, it <span class="bcp14">MUST</span> abort the request with error "unrecognizedTask".
Otherwise, if the Helper supports this mechanism, it proceeds as follows.<a href="#section-4.7-2" class="pilcrow">¶</a></p>
<p id="section-4.7-3">First, the Helper attempts to parse payload of the "dap-taskprov" HTTP header.
If this step fails, the Helper <span class="bcp14">MUST</span> abort with "invalidMessage".<a href="#section-4.7-3" class="pilcrow">¶</a></p>
<p id="section-4.7-4">Next, the Helper checks that the task ID indicated in the request matches the
task ID derived from the <code>TaskConfig</code> as defined in <a href="#definition" class="auto internal xref">Section 3</a>. If not, the
Helper <span class="bcp14">MUST</span> abort with "unrecognizedTask".<a href="#section-4.7-4" class="pilcrow">¶</a></p>
<p id="section-4.7-5">Next, the Helper decides whether to opt in to the task as described in
<a href="#provisioning-a-task" class="auto internal xref">Section 4.4</a>. If it opts out, it <span class="bcp14">MUST</span> abort the request with
"invalidTask".<a href="#section-4.7-5" class="pilcrow">¶</a></p>
<p id="section-4.7-6">Finally, the Helper completes the request as usual, deriving the VDAF
verification key for the task as described in <a href="#vdaf-verify-key" class="auto internal xref">Section 4.3</a>. During an
aggregation job, for any report share that does not include the <code>taskprov</code>
extension with an empty payload, the Helper <span class="bcp14">MUST</span> mark the report as invalid
with error "invalid_message" and reject it.<a href="#section-4.7-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="collector-behavior">
<section id="section-4.8">
        <h3 id="name-collector-behavior">
<a href="#section-4.8" class="section-number selfRef">4.8. </a><a href="#name-collector-behavior" class="section-name selfRef">Collector Behavior</a>
        </h3>
<p id="section-4.8-1">Upon receiving a <code>TaskConfig</code> from the Author, the Collector first decides
whether to opt into the task as described in <a href="#provisioning-a-task" class="auto internal xref">Section 4.4</a>. If the
Collector opts out, it <span class="bcp14">MUST NOT</span> attempt to initialize collection jobs for the
task.<a href="#section-4.8-1" class="pilcrow">¶</a></p>
<p id="section-4.8-2">Otherwise, once opted in, the Collector <span class="bcp14">MAY</span> begin to issue collect requests for
the task. The task ID for each request <span class="bcp14">MUST</span> be derived from the <code>TaskConfig</code> as
described in <a href="#provisioning-a-task" class="auto internal xref">Section 4.4</a>. The Collector <span class="bcp14">MUST</span> advertise the task as
described in <a href="#task-advertisement" class="auto internal xref">Section 4.2</a>.<a href="#section-4.8-2" class="pilcrow">¶</a></p>
<p id="section-4.8-3">If the Leader responds to a collection request with an "unrecognizedTask"
error, the Collector <span class="bcp14">MAY</span> retry its request after waiting an appropriate
amount of time.<a href="#section-4.8-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="security-considerations">
<section id="section-5">
      <h2 id="name-security-considerations">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-5-1">The Taskprov extension has the same security and privacy considerations as the
core DAP protocol. In addition, successful execution of a DAP task implies
agreement on the task configuration. This is provided by binding the
parameters to the task ID, which in turn is bound to each report uploaded for a
task. Furthermore, inclusion of the Taskprov extension in the report means
Aggregators that do not implement this extension will reject the report as
required by (<span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-ppm-dap-16#section-4.5.3" class="relref">Section 4.5.3</a> of [<a href="#DAP" class="cite xref">DAP</a>]</span>).<a href="#section-5-1" class="pilcrow">¶</a></p>
<p id="section-5-2">The task provisioning mechanism in <a href="#taskprov" class="auto internal xref">Section 4</a> extends the threat model of DAP
by including a new logical role, called the Author. The Author is responsible
for configuring Clients prior to task execution. For privacy we consider the
Author to be under control of the adversary. It is therefore incumbent on
protocol participants to verify the privacy parameters of a task before opting
in.<a href="#section-5-2" class="pilcrow">¶</a></p>
<p id="section-5-3">Another risk is that the Author could configure a unique task to fingerprint a
Client. Although Client anonymization is not guaranteed by DAP, some systems
built on top of DAP may hope to achieve this property by using a proxy server
with Oblivious HTTP <span>[<a href="#RFC9458" class="cite xref">RFC9458</a>]</span> to forward Client reports to the Leader. If the
Author colludes with the Leader, the attacker can learn some metadata
information about the Client, e.g., the Client IP, user agent string, which may
deanonymize the Client. However, even if the Author succeeds in doing so, the
Author should learn nothing other than the fact that the Client has uploaded a
report, assuming the Client has verified the privacy parameters of the task
before opting into it. For example, if a task is uniquely configured for the
Client, the Client can enforce the minimum batch size is strictly more than 1.<a href="#section-5-3" class="pilcrow">¶</a></p>
<p id="section-5-4">Another risk for the Aggregators is that a malicious coalition of Clients might
attempt to pollute an Aggregator's long-term storage by uploading reports for
many (thousands or perhaps millions) of distinct tasks. While this does not
directly impact tasks used by honest Clients, it does present a
Denial-of-Service risk for the Aggregators themselves. This can be mitigated by
limiting the rate at which new tasks are configured. In addition, deployments
<span class="bcp14">SHOULD</span> arrange for the Author to digitally sign the task configuration so that
Clients cannot forge task creation, e.g., via an extension to Taskprov
(<a href="#taskprov-extensions" class="auto internal xref">Section 3.3</a>).<a href="#section-5-4" class="pilcrow">¶</a></p>
<p id="section-5-5">Support for the Taskprov extension may render a deployment of DAP more
susceptible to task enumeration attacks (<span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-ppm-dap-16#section-8.6.1" class="relref">Section 8.6.1</a> of [<a href="#DAP" class="cite xref">DAP</a>]</span>). For
example, if the Leader's upload endpoint is unauthenticated, then any HTTP
client can learn if a Leader supports a particular task configuration by
uploading a report for it with the Taskprov extension. Aggregators can mitigate
these kinds of attack by:<a href="#section-5-5" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-5-6">
<li id="section-5-6.1">
          <p id="section-5-6.1.1">Requiring authentication of all APIs, including the upload endpoint (see
<span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-ppm-dap-16#section-3.3" class="relref">Section 3.3</a> of [<a href="#DAP" class="cite xref">DAP</a>]</span>);<a href="#section-5-6.1.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-5-6.2">
          <p id="section-5-6.2.1">Enforcing rate limits on unauthenticated APIs; or<a href="#section-5-6.2.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-5-6.3">
          <p id="section-5-6.3.1">Including entropy in the <code>task_info</code> field of the <code>TaskConfig</code> in order to
make the task ID harder to predict (e.g., 16 bytes of output of a CSPRNG).<a href="#section-5-6.3.1" class="pilcrow">¶</a></p>
</li>
      </ol>
</section>
</div>
<div id="operational-considerations">
<section id="section-6">
      <h2 id="name-operational-considerations">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-operational-considerations" class="section-name selfRef">Operational Considerations</a>
      </h2>
<p id="section-6-1">The Taskprov extension does not introduce any new operational considerations
for DAP.<a href="#section-6-1" class="pilcrow">¶</a></p>
<p id="section-6-2">The task provisioning mechanism in <a href="#taskprov" class="auto internal xref">Section 4</a> is designed so that the
Aggregators do not need to store individual task configurations long-term.
Because the task configuration is advertised in each request in the upload,
aggregation, and collection protocols, the process of opting-in and deriving the
task ID and VDAF verify key can be re-run on the fly for each request. This is
useful if a large number of concurrent tasks are expected. Once an Aggregator
has opted-in to a task, the expectation is that the task is supported until it
ends. In particular, Aggregators that operate in this manner <span class="bcp14">MUST NOT</span> opt
out once they have opted in.<a href="#section-6-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="iana-considerations">
<section id="section-7">
      <h2 id="name-iana-considerations">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-7-1">This document requests a codepoint for the <code>taskprov</code> report extension and for
creation of a new registry for Taskprov extensions.<a href="#section-7-1" class="pilcrow">¶</a></p>
<p id="section-7-2">(RFC EDITOR: Replace "XXXX" with the RFC number assigned to this document.)<a href="#section-7-2" class="pilcrow">¶</a></p>
<div id="report-extension">
<section id="section-7.1">
        <h3 id="name-report-extension">
<a href="#section-7.1" class="section-number selfRef">7.1. </a><a href="#name-report-extension" class="section-name selfRef">Report Extension</a>
        </h3>
<p id="section-7.1-1">The following entry will be (RFC EDITOR: change "will be" to "has been") added
to the "Report Extension Identifiers" registry of the "Distributed Aggregation
Protocol (DAP)" page created by <span>[<a href="#DAP" class="cite xref">DAP</a>]</span>:<a href="#section-7.1-1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-7.1-2">
          <dt id="section-7.1-2.1">Value:</dt>
          <dd style="margin-left: 1.5em" id="section-7.1-2.2">
            <p id="section-7.1-2.2.1"><code>0xff00</code><a href="#section-7.1-2.2.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-7.1-2.3">Name:</dt>
          <dd style="margin-left: 1.5em" id="section-7.1-2.4">
            <p id="section-7.1-2.4.1"><code>taskprov</code><a href="#section-7.1-2.4.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-7.1-2.5">Reference:</dt>
          <dd style="margin-left: 1.5em" id="section-7.1-2.6">
            <p id="section-7.1-2.6.1">RFC XXXX<a href="#section-7.1-2.6.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
</dl>
</section>
</div>
<div id="taskprov-extension-registry">
<section id="section-7.2">
        <h3 id="name-registry-for-taskprov-exten">
<a href="#section-7.2" class="section-number selfRef">7.2. </a><a href="#name-registry-for-taskprov-exten" class="section-name selfRef">Registry for Taskprov Extensions</a>
        </h3>
<p id="section-7.2-1">A new registry will be (RFC EDITOR: change "will be" to "has been") created for
the "Distributed Aggregation Protocol (DAP)" page called "Taskprov Extensions".
This registry contains the following columns:<a href="#section-7.2-1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-7.2-2">
          <dt id="section-7.2-2.1">Value:</dt>
          <dd style="margin-left: 1.5em" id="section-7.2-2.2">
            <p id="section-7.2-2.2.1">The two-byte identifier for the extension<a href="#section-7.2-2.2.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-7.2-2.3">Name:</dt>
          <dd style="margin-left: 1.5em" id="section-7.2-2.4">
            <p id="section-7.2-2.4.1">The name of the extension<a href="#section-7.2-2.4.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-7.2-2.5">Reference:</dt>
          <dd style="margin-left: 1.5em" id="section-7.2-2.6">
            <p id="section-7.2-2.6.1">Where the mechanism is defined<a href="#section-7.2-2.6.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
</dl>
<p id="section-7.2-3">The initial contents of this registry are listed in the following table.<a href="#section-7.2-3" class="pilcrow">¶</a></p>
<span id="name-initial-contents-of-the-tas"></span><div id="taskprov-extension-id">
<table class="center" id="table-2">
          <caption>
<a href="#table-2" class="selfRef">Table 2</a>:
<a href="#name-initial-contents-of-the-tas" class="selfRef">Initial contents of the Taskprov Extensions registry.</a>
          </caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">Value</th>
              <th class="text-left" rowspan="1" colspan="1">Name</th>
              <th class="text-left" rowspan="1" colspan="1">Reference</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">
                <code>0x0000</code>
</td>
              <td class="text-left" rowspan="1" colspan="1">
                <code>reserved</code>
</td>
              <td class="text-left" rowspan="1" colspan="1">
                <a href="#taskprov-extensions" class="auto internal xref">Section 3.3</a> of RFC XXXX</td>
            </tr>
          </tbody>
        </table>
</div>
</section>
</div>
<div id="dap-sub-namespace-for-dap">
<section id="section-7.3">
        <h3 id="name-dap-sub-namespace-for-dap">
<a href="#section-7.3" class="section-number selfRef">7.3. </a><a href="#name-dap-sub-namespace-for-dap" class="section-name selfRef">DAP Sub-namespace for DAP</a>
        </h3>
<ul class="normal ulEmpty">
<li class="normal ulEmpty" id="section-7.3-1.1">
            <p id="section-7.3-1.1.1">TODO Figure out how to ask IANA to register the errors in
<a href="#urn-space-errors" class="auto internal xref">Table 1</a>. See
https://github.com/ietf-wg-ppm/draft-ietf-ppm-dap-taskprov/issues/34<a href="#section-7.3-1.1.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
</section>
</div>
<div id="extending-this-doc">
<section id="section-8">
      <h2 id="name-extending-this-document">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-extending-this-document" class="section-name selfRef">Extending this Document</a>
      </h2>
<p id="section-8-1">The behavior of the <code>taskprov</code> extension may be extended by future documents
that define:<a href="#section-8-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-8-2">
<li id="section-8-2.1">
          <p id="section-8-2.1.1">A new DAP batch mode<a href="#section-8-2.1.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-8-2.2">
          <p id="section-8-2.2.1">A new VDAF<a href="#section-8-2.2.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-8-2.3">
          <p id="section-8-2.3.1">A new Taskprov extension<a href="#section-8-2.3.1" class="pilcrow">¶</a></p>
</li>
      </ol>
<p id="section-8-3">Documents defining either a new DAP batch mode or VDAF <span class="bcp14">SHOULD</span> include a section
titled "Taskprov Considerations" that specifies the payload of
<code>TaskConfig.batch_config</code> or <code>TaskConfig.vdaf_config</code> respectively.<a href="#section-8-3" class="pilcrow">¶</a></p>
<p id="section-8-4">Note that the registry for batch modes is defined by <span>[<a href="#DAP" class="cite xref">DAP</a>]</span>; the registry for
VDAFs is defined by <span>[<a href="#VDAF" class="cite xref">VDAF</a>]</span>; and the registry for Taskprov extensions is defined in
<a href="#taskprov-extension-registry" class="auto internal xref">Section 7.2</a> of this document.<a href="#section-8-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sec-normative-references">
<section id="section-9">
      <h2 id="name-normative-references">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
      </h2>
<dl class="references">
<dt id="DAP">[DAP]</dt>
      <dd>
<span class="refAuthor">Geoghegan, T.</span>, <span class="refAuthor">Patton, C.</span>, <span class="refAuthor">Pitman, B.</span>, <span class="refAuthor">Rescorla, E.</span>, and <span class="refAuthor">C. A. Wood</span>, <span class="refTitle">"Distributed Aggregation Protocol for Privacy Preserving Measurement"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-ppm-dap-16</span>, <time datetime="2025-09-02" class="refDate">2 September 2025</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-ppm-dap-16">https://datatracker.ietf.org/doc/html/draft-ietf-ppm-dap-16</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2119">[RFC2119]</dt>
      <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc2119">https://www.rfc-editor.org/rfc/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4648">[RFC4648]</dt>
      <dd>
<span class="refAuthor">Josefsson, S.</span>, <span class="refTitle">"The Base16, Base32, and Base64 Data Encodings"</span>, <span class="seriesInfo">RFC 4648</span>, <span class="seriesInfo">DOI 10.17487/RFC4648</span>, <time datetime="2006-10" class="refDate">October 2006</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc4648">https://www.rfc-editor.org/rfc/rfc4648</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5869">[RFC5869]</dt>
      <dd>
<span class="refAuthor">Krawczyk, H.</span> and <span class="refAuthor">P. Eronen</span>, <span class="refTitle">"HMAC-based Extract-and-Expand Key Derivation Function (HKDF)"</span>, <span class="seriesInfo">RFC 5869</span>, <span class="seriesInfo">DOI 10.17487/RFC5869</span>, <time datetime="2010-05" class="refDate">May 2010</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc5869">https://www.rfc-editor.org/rfc/rfc5869</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
      <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8174">https://www.rfc-editor.org/rfc/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9180">[RFC9180]</dt>
      <dd>
<span class="refAuthor">Barnes, R.</span>, <span class="refAuthor">Bhargavan, K.</span>, <span class="refAuthor">Lipp, B.</span>, and <span class="refAuthor">C. Wood</span>, <span class="refTitle">"Hybrid Public Key Encryption"</span>, <span class="seriesInfo">RFC 9180</span>, <span class="seriesInfo">DOI 10.17487/RFC9180</span>, <time datetime="2022-02" class="refDate">February 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9180">https://www.rfc-editor.org/rfc/rfc9180</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9458">[RFC9458]</dt>
      <dd>
<span class="refAuthor">Thomson, M.</span> and <span class="refAuthor">C. A. Wood</span>, <span class="refTitle">"Oblivious HTTP"</span>, <span class="seriesInfo">RFC 9458</span>, <span class="seriesInfo">DOI 10.17487/RFC9458</span>, <time datetime="2024-01" class="refDate">January 2024</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9458">https://www.rfc-editor.org/rfc/rfc9458</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="SHS">[SHS]</dt>
      <dd>
<span class="refTitle">"Secure Hash Standard"</span>, <span class="seriesInfo">FIPS PUB 180-4 </span>, <time datetime="2015-08-04" class="refDate">4 August 2015</time>. </dd>
<dd class="break"></dd>
<dt id="VDAF">[VDAF]</dt>
    <dd>
<span class="refAuthor">Barnes, R.</span>, <span class="refAuthor">Cook, D.</span>, <span class="refAuthor">Patton, C.</span>, and <span class="refAuthor">P. Schoppmann</span>, <span class="refTitle">"Verifiable Distributed Aggregation Functions"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-irtf-cfrg-vdaf-15</span>, <time datetime="2025-06-17" class="refDate">17 June 2025</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-vdaf-15">https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-vdaf-15</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
<div id="contributors">
<section id="appendix-A">
      <h2 id="name-contributors">
<a href="#name-contributors" class="section-name selfRef">Contributors</a>
      </h2>
<p id="appendix-A-1">Junye Chen
Apple Inc.
junyec@apple.com<a href="#appendix-A-1" class="pilcrow">¶</a></p>
<p id="appendix-A-2">David Cook
ISRG
divergentdave@gmail.com<a href="#appendix-A-2" class="pilcrow">¶</a></p>
<p id="appendix-A-3">Suman Ganta
Apple Inc.
sganta2@apple.com<a href="#appendix-A-3" class="pilcrow">¶</a></p>
<p id="appendix-A-4">Gianni Parsa
Apple Inc.
gianni_parsa@apple.com<a href="#appendix-A-4" class="pilcrow">¶</a></p>
<p id="appendix-A-5">Michael Scaria
Apple Inc.
mscaria@apple.com<a href="#appendix-A-5" class="pilcrow">¶</a></p>
<p id="appendix-A-6">Kunal Talwar
Apple Inc.
ktalwar@apple.com<a href="#appendix-A-6" class="pilcrow">¶</a></p>
<p id="appendix-A-7">Christopher A. Wood
Cloudflare
caw@heapingbits.net<a href="#appendix-A-7" class="pilcrow">¶</a></p>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-B">
      <h2 id="name-authors-addresses">
<a href="#name-authors-addresses" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Shan Wang</span></div>
<div dir="auto" class="left"><span class="org">Apple Inc.</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:shan_wang@apple.com" class="email">shan_wang@apple.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Christopher Patton</span></div>
<div dir="auto" class="left"><span class="org">Cloudflare</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:chrispatton+ietf@gmail.com" class="email">chrispatton+ietf@gmail.com</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
